# üöÄ PostingFotoTG

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–æ–≤ –æ–± —É–±–æ—Ä–∫–µ –ø–æ–¥—ä–µ–∑–¥–æ–≤**

üì¶ Bitrix24 ‚Üí GPT ‚Üí Telegram

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –í Bitrix24 —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞–¥–∏—é **"–£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"**
2. Bitrix –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫:
   ```json
   POST /webhook/register_folder
   {
     "deal_id": 12345,
     "folder_id": 199058
   }
   ```
3. FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑ Bitrix (–ø–æ folder_id)
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç (GPT)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –º–µ–¥–∏–∞ –≤ Telegram

---

## üì° –ú–∞—Ä—à—Ä—É—Ç—ã API

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ            |
|-------|---------------------------|------------------------|
| GET   | `/`                       | Healthcheck            |
| POST  | `/webhook/register_folder` | üì• –û—Å–Ω–æ–≤–Ω–æ–π webhook    |
| POST  | `/webhook/debug_log`     | üêû –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞    |
| POST  | `/webhook/test`          | üîÅ –¢–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç     |

---

## ü§ñ GPT-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (OpenAI)

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –ó–Ω–∞—á–µ–Ω–∏–µ          |
|--------------|-------------------|
| –ú–æ–¥–µ–ª—å       | gpt-3.5-turbo     |
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞  | 0.9               |
| Prompt       | –í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π —Ç–µ–∫—Å—Ç —É–±–æ—Ä–∫–∏ |
| Fallback     | "–£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ –∑–∞ —á–∏—Å—Ç–æ—Ç—É üßπ" |

---

## üñºÔ∏è Telegram

- `sendMediaGroup` –¥–ª—è —Ñ–æ—Ç–æ
- `.mp4` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown –≤ –ø–æ–¥–ø–∏—Å–∏

---

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è Bitrix

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ      | UF_ –∫–æ–¥ –ø–æ–ª—è            |
|-----------------|-------------------------|
| –ü–∞–ø–∫–∞ —Ñ–∞–π–ª–æ–≤     | `UF_CRM_1686038818`     |
| –§–æ—Ç–æ            | `UF_CRM_1740994275251`  |
| –ê–¥—Ä–µ—Å           | `UF_CRM166956159956`    |
| –î–∞—Ç—ã –∏ —Ç–∏–ø—ã     | `UF_CRM1741590925181`, `UF_CRM174159176502` |

---

## üåç –ü—Ä–∏–º–µ—Ä curl

```bash
curl -X POST https://postingfototg.onrender.com/webhook/register_folder \
  -H "Content-Type: application/json" \
  -d '{"deal_id": 11720, "folder_id": 199058}'
```

---

## üîê .env (–ø—Ä–∏–º–µ—Ä)

```env
TG_GITHUB_BOT=xxx
TG_CHAT_ID=xxx
OPENAI_API_KEY=sk-xxx
BITRIX_WEBHOOK=https://.../rest/1/...
FILE_FIELD_ID=UF_CRM_...
```

---

## üß† –°—Ç–µ–∫

- `FastAPI`, `httpx`, `pydantic`
- `OpenAI GPT`, `loguru`, `requests`
- `Telegram Bot API`, `Markdown`
- `Render`, `GitHub Actions`

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å GPT ü§ñ
> –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ **"–í–∞—à –î–æ–º"**, –≥. –ö–∞–ª—É–≥–∞