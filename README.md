# üöÄ PostingFotoTG

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–æ–≤ –æ–± —É–±–æ—Ä–∫–µ –ø–æ–¥—ä–µ–∑–¥–æ–≤:

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **Bitrix24** (—Å–¥–µ–ª–∫–∏ + —Ñ–∞–π–ª—ã + —Å—Ç–∞–¥–∏—è)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ **OpenAI GPT-3.5 Turbo**
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ñ–æ—Ç–æ –≤ **Telegram**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ, Markdown, fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. Bitrix –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–¥–µ–ª–∫—É –≤ —Å—Ç–∞–¥–∏—é "–£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
2. Bitrix –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫:
   ```json
   POST /webhook/register_folder
   {
     "deal_id": 12345,
     "folder_id": 199058
   }
   ```
3. FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑ Bitrix –ø–æ –ø–∞–ø–∫–µ
   - –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç —Ñ–∞–π–ª—ã –∫ —Å–¥–µ–ª–∫–µ
   - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç (–∞–¥—Ä–µ—Å + GPT)
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram

---

## üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                        |
|-------|------------------------------|-----------------------------------|
| GET   | `/`                          | üîç Healthcheck                    |
| POST  | `/webhook/register_folder`  | üì• –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç Bitrix  |
| POST  | `/webhook/debug_log`        | üêû –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –≤–µ–±—Ö—É–∫–∞      |
| POST  | `/webhook/test`             | üîÅ –≠—Ö–æ-–∑–∞–ø—Ä–æ—Å (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)        |

---

## üì° Telegram-–±–æ—Ç

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sendMediaGroup` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –ø–∞—á–∫–∞–º–∏
- –ü–æ–¥–ø–∏—Å—å —Ç–æ–ª—å–∫–æ —É –ø–µ—Ä–≤–æ–π —Ñ–æ—Ç–æ, –≤ —Ñ–æ—Ä–º–∞—Ç–µ **Markdown**
- –í–∏–¥–µ–æ (`.mp4`) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, —Å –ø–æ–¥–ø–∏—Å—å—é-–∞–¥—Ä–µ—Å–æ–º

---

## üß† GPT-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (openai==1.75.0)

- –ú–æ–¥–µ–ª—å: `gpt-3.5-turbo`
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.9 (—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ)
- –ü—Ä–æ–º–ø—Ç: –∫–æ—Ä–æ—Ç–∫–∏–π, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Å bait –Ω–∞ –æ—Ç–∑—ã–≤—ã
- Fallback-—Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ GPT: "–£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ –∑–∞ —á–∏—Å—Ç–æ—Ç—É üßπ"

---

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è Bitrix

| –ù–∞–∑–≤–∞–Ω–∏–µ      | –°–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ (–ø—Ä–∏–º–µ—Ä)       |
|---------------|-------------------------------|
| üìÅ –ü–∞–ø–∫–∞      | `UF_CRM_1686038818`           |
| üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ | `UF_CRM_1740994275251`        |
| üè† –ê–¥—Ä–µ—Å      | `UF_CRM166956159956`          |
| üìÖ –î–∞—Ç—ã       | `UF_CRM1741590925181`, `...`  |
| üßΩ –¢–∏–ø—ã       | `UF_CRM174159176502`, `...`   |

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä `curl`

```bash
curl -X POST https://postingfototg.onrender.com/webhook/register_folder \
  -H "Content-Type: application/json" \
  -d '{"deal_id": 11720, "folder_id": 199058}'
```

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `.env` (–Ω–∞ Render)

```env
TG_GITHUB_BOT=xxx
TG_CHAT_ID=xxx
OPENAI_API_KEY=sk-xxx
BITRIX_WEBHOOK=https://.../rest/1/...
FILE_FIELD_ID=UF_CRM_...
```

---

## üë®‚Äçüîß –ê–≤—Ç–æ—Ä

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å GPT üí™ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥ –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ Bitrix24 –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–í–∞—à –î–æ–º" (–≥. –ö–∞–ª—É–≥–∞).
